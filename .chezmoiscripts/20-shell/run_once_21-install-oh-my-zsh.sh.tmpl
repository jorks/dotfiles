#!/usr/bin/env sh
set -eu

# -------------------------------------------------------------------
# PURPOSE:
#   Install Oh My Zsh framework
#
# SCOPE:
#   - Runs on: macOS, Linux
#   - Lifecycle: run_once
#
# BEHAVIOUR:
#   - Idempotent (skips if already installed)
#   - Non-interactive installation
#   - Does not modify existing .zshrc (chezmoi manages that)
#
# NOTES:
#   - Installs to ~/.oh-my-zsh
#   - Framework only - configuration via dotfiles
#   - Plugins installed separately
# -------------------------------------------------------------------

# shellcheck source=../_lib/log.sh
. "{{ .chezmoi.sourceDir }}/.chezmoiscripts/_lib/log.sh"

# Check if already installed
if [ -d "$HOME/.oh-my-zsh" ]; then
  log_info "Oh My Zsh already installed"
  exit 0
fi

log_info "Installing Oh My Zsh..."

# Install non-interactively
# RUNZSH=no    - Don't launch zsh after install
# CHSH=no      - Don't change shell (we handle that separately)
# KEEP_ZSHRC=yes - Don't overwrite .zshrc (chezmoi manages it)
if RUNZSH=no CHSH=no KEEP_ZSHRC=yes sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"; then
  log_success "Oh My Zsh installed"
else
  log_error "Oh My Zsh installation failed"
  exit 1
fi
